# LINEで彼女を落とせ！

## 🧹 プロジェクトの概要

このプロジェクトは、LINE風のチャット画面で女性キャラクター（AI）を口説き落とす恋愛シミュレーションゲームです。ユーザーが入力したメッセージに応じてAIの好感度が変化し、最終的に彼女にできるかどうかが決まります。

## 🌟 目的

* LLM（大規模言語モデル）の特性を活かしたインタラクティブなゲーム開発を体験する。
* Gemini CLIでプロジェクトを管理し、開発環境に慣れる。
* 自然な対話UIを通じてWebアプリ開発の基礎を体験する。

## 👤 想定ユーザー

* プログラミング初学者
* Web開発入門者
* 面白いインタラクティブコンテンツを体験したいユーザー

## ⚙️ 現在の機能一覧

* LINE風チャットUI（背景色、吹き出し、入力欄、送信ボタン）
* Google Gemini APIを利用したAIキャラクターとの会話
* 好感度システム（AIの返答内容で好感度が変化）
* 会話回数制限（10回でゲーム終了、好感度でクリア/オーバー判定）
* メッセージのタイムスタンプ表示
* ユーザーメッセージの既読マーク表示

## 💻 使用技術

* フロントエンド: HTML, CSS, JavaScript
* バックエンド: Node.js (Express.js)
* AI: Google Gemini API
* 開発環境: live-server, Puppeteer

## 🗂️ ディレクトリ構成

```
.env                 # APIキーなどの環境変数
.gitignore           # Git管理から除外するファイル
index.html           # ゲーム画面のHTML構造
style.css            # ゲーム画面のスタイル定義
script.js            # ゲームのロジック（フロントエンド）
package.json         # プロジェクト情報と依存パッケージ
package-lock.json    # 依存パッケージのバージョン管理
test.js              # Puppeteerによる自動テストスクリプト
README.md            # プロジェクトの概要と起動方法
docs/                # ドキュメンテーション
├── design_document.md # デザインに関するドキュメント
└── character_settings.md # キャラクター設定に関するドキュメント
server/              # バックエンドサーバー関連
├── index.js         # バックエンドサーバーのメインロジック
├── package.json     # バックエンドの依存パッケージ
└── node_modules/    # バックエンドの依存パッケージの実体
node_modules/        # フロントエンドの依存パッケージの実体
screenshot_*.png     # 自動テストで生成されるスクリーンショット
```

## 🚀 今後の課題（優先度順）

### 1. 会話履歴のLLMへの引き継ぎ（最優先）

- **現状:** 現在、LLMへのリクエストはユーザーの最新メッセージのみ。過去の会話履歴をLLMに渡すことで、より文脈を理解した自然な会話を可能にする。
- **目標:** LLMが過去の会話を記憶し、より連続性のある返答を生成できるようにする。
- **具体的な作業:**
  - `script.js`で会話履歴を管理し、バックエンドに送信する。
  - `server/index.js`で会話履歴を受け取り、LLMに渡す。

### 2. 好感度変化ロジックの洗練

- **現状:** LLMからの返答内容に含まれる特定のキーワードに基づいて好感度を変化させている。
- **目標:** より複雑な感情や文脈を理解して好感度を変化させる。LLMの返答から好感度への影響度を判断できるようにする。
- **具体的な作業:**
  - LLMに好感度変化のトリガーとなるキーワードや感情を明示的に出力させるプロンプト調整。
  - 返答の感情分析を行う（より高度な課題）。

### 3. メッセージの長さの変化

- **現状:** LLMからの返信が、常に同じような長さになりがち。
- **目標:** LLMからの返信が、時には短く、時には長く、複数の文で返答するように調整する。
- **具体的な作業:**
  - バックエンドのLLMプロンプトに、返答の長さにバリエーションを持たせる指示を追加。
  - `maxOutputTokens`の調整。

### 4. タイムスタンプと既読マークの位置調整

- **現状:** ユーザーメッセージのタイムスタンプと既読マークが、吹き出しの下に、かつ右寄せで表示されるべきだが、まだ左端に表示される課題が残っている。
- **目標:** LINEのUIに近づけるため、タイムスタンプと既読マークをユーザーメッセージの吹き出しの右下に配置する。
- **具体的な作業:**
  - `style.css`のFlexboxプロパティを再調整し、要素の配置を修正する。

### 5. ゲームクリア/オーバー条件の調整

- **現状:** 好感度と会話回数のみで判定。
- **目標:** 特定の会話内容やユーザーの行動がゲーム結果に影響するようにする。
- **具体的な作業:**
  - 特定のキーワードや会話の進捗に応じて、好感度への影響を大きくする。

### 6. キャラクター設定の強化

- **現状:** 女性キャラクターの性格や口調はプロンプトで設定済み。
- **目標:** より詳細な設定（年齢、職業、趣味、口癖など）を追加し、より魅力的で一貫性のあるAIキャラクターにする。
- **具体的な作業:**
  - `docs/character_settings.md`に詳細な設定を記述し、LLMプロンプトに反映させる。

## ✅ 完了の定義（Definition of Done）

* 入力フォームと送信ボタンでメッセージを送れる
* チャットログに会話履歴が表示される
* LLMからの返答がチャットログに表示される
* 好感度が変化し、ゲームのクリア/オーバーが判定される
* ローカル環境でブラウザから実行して動作確認できる
